# TRPG AIAgent GM プロジェクトのための変更点

## 技術スタック変更点

デプロイを Google cloud run に変更する
ストレージは Cloud Storage(各種画像用)
データベースは Litestream とする。

## 画面の実装内容変更点

### あらすじ

特に変更を行わないが、TRPG セッションを設定するためのシステムプロンプトにする。

### プロット

ざっくりと、X 日目に～～が起きる、という大まかなプロットを定義する。

### キャラクター

パーティ編成画面に変更する。
新規キャラクター追加や、各シナリオで許容される人数までキャラクターを設定できる。
TRPG ように、ステータスは次のファイルの形式に変更する。(docs\キャラクター.md 参照)
イメージ画像については、AI agent に考えて作ってもらえる機能を作成する。

### 執筆画面

TRPG ゲーミング用フロントエンドに変更

### タイムライン画面

現在の、XXX 年～ XXX 年、という時間軸の定義から、
1 日目～ X 日目（ユーザー指定できる日数）のレイアウトに変更。
敵キャラクターは基本的に場所と日数が固定されて、ユーザーが同じ時間と場所に来ると戦闘となる。

### 世界観構築画面

ワールド設定とし、設定内容はある程度大まかなものとする。
拠点,md を参考にして、拠点の情報を設定可能にすること。
拠点は拠点 img を持っていて、TRPG フロントエンドではその拠点に同時にいる、ユーザー操作しているキャラ以外の立ち絵を表示する。
拠点 img については、AI agent に考えて作ってもらう機能を実装する。

## 機能の変更点

### キャラクター/キャラクター＆敵キャラクターが干渉するための型を追加(キャラクター実施イベント)

他のキャラクターに鑑賞するための、イベント型を定義
攻撃すると HP を減らす、状態異常を回復する → 対象の状態異常を解除など

### 開発モード切り替え機能の追加

設定タブに開発者モード切り替えスイッチを追加する。
基本的にはオフになっており、オンになると各種設定項目が表示される。
オフのときに表示されるのは、ゲーム開始前のときはパーティ設定と TRPG セッションへの繊維のみ。
ゲーム開始後は、設定タブと AIChat パネルの表示が負荷となり、フロントエンドから表示非表示切り替えを行うボタンが非表示となる。

## 追加する画面要素

### TRPG セッション画面

概要
ざっくりとしたワイヤーフレームは docs\UI 考案.png
画面名は、TRPG セッション画面とする。
TRPG のシナリオをプレイするための、メインとなる画面。
基本的にはユーザーはこの画面で遊ぶことになる。
シナリオ開始時、ユーザーはキャラクターの一人を選んでゲーム開始を選択する。
ゲーム開始時、AI agent から、チャット画面を通じてゲームについてざっくりとした解説を受ける。
そして、基本的には agent が提供する選択肢をユーザーが選んで行動を決めていくことになる。
ユーザーのターンになった時選択可能な行動は、移動(街や拠点)、買い物、NPC との会話、他キャラクターへの干渉など。
また、場所と日付によりイベントが定義されている。
ユーザーが行動を行い、イベントの完了条件を満たす・行動回数が特定を超えた時、その日を終了として次の日が開始することになる。
戦闘時や、スキル使用時、また強行突破（イベントフラグが必要な、例えば鍵のかかった扉などを）する場合の、パワーチェックなどがインタラクト画面に表示される。
また、チャットはログ機能を持っており、X 日目としていすることで遡ることができる。
そして、右上には常にゲームに参加している全キャラクターが表示されている。
（暗闇の状態異常の場合は、見えなくなるなど例外もある）
全キャラクターの下に自キャラクターの装備やスキルが表示される。

各機能について説明する。
画像(~~)参照
ホーム画面からシナリオを選択した時、まずはこの画面に案内される。
イラスト: イラストの URL を、プロジェクトの定義から受け取る。
(イラストの Storage については要検討)
インタラクト:
ダイスロール UI: 攻撃の威力や、イベントの成功条件となる
スキルチェック UI: スキルを実行した際のチェック
(円形の見た目に一部緑色の切れ込み、ボタンクリックでバーが時計回りに動き、緑色のゾーンで止めることができたら成功、難易度は各種スキルに依存)
パワーチェック: 一定時間にボタンを連打して成功・失敗を決める。キャラクターの力のステータスに依存する。
成功・失敗の結果を Ai agent が受け取り、チャット画面にキャラクターがどうなったかの情報を与え、またユーザーの行動するターンとなる流れ。

### 敵キャラクター定義画面

基本的には、プレイヤーキャラクターより少なめな体力の敵を追加する。
具体的な型定義は、docs\エネミー.md を参照する。
モブ・エネミーリーダー・ボスのクラスを持ち、ボスクラスはキャラクター全員で協力して戦うなど、強い設定とする。
TRPG ゲーミング用フロントエンドにおいて、どんな行動を行うかは、基本的に AI agent が決定する。

### NPC 設定

街にいて、基本的には提携の文章を返す。
TRPG ゲーミング用フロントエンドにおいて、返答内容や行動については基本的に AI agent が考える。

## 不足している実装

ユーザー認証・サーバーサイドの実装
・TRPG のマルチプレイヤーモード実装し課金制度はチケット制(1play200 円?)
・ユーザー作成のシナリオを遊んだ場合、シナリオ作者に還元(60%とか)→ ユーザーがユーザーのためにコンテンツを作るモチベーション、拡散力
