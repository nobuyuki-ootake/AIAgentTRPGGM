# アーキテクチャ改善対象

本ドキュメントでは、アプリケーションのアーキテクチャを改善するために対応が必要なファイルと、その改善状況を記録します。

## 対応の種類

1. **ロジックと UI の分離**：ビジネスロジックをカスタムフックとして分離し、UI コンポーネントはプレゼンテーショナルな役割に集中させる
2. **コンポーネント構造の改善**：大きなコンポーネントを小さな再利用可能なコンポーネントに分割し、責任範囲を明確にする

## ページコンポーネントの対応状況

| ページコンポーネント  | ファイルサイズ | ロジックと UI の分離 | コンポーネント構造の改善 | 備考                                                                                                    |
| --------------------- | -------------- | -------------------- | ------------------------ | ------------------------------------------------------------------------------------------------------- |
| SynopsisPage.tsx      | 小 (66 行)     | ✅ 対応済み          | ✅ 対応済み              | `useSynopsis`フックと、`SynopsisEditor`, `SynopsisTips`, `UnsavedChangesDialog`コンポーネントに分離済み |
| CharactersPage.tsx    | 大 (1172 行)   | ✅ 対応済み          | ✅ 対応済み              | `useCharacters`フックと Character 関連コンポーネントに分離済み                                          |
| TimelinePage.tsx      | 大 (1091 行)   | ✅ 対応済み          | ✅ 対応済み              | `useTimeline`フックと Timeline 関連コンポーネントに分離済み                                             |
| WorldBuildingPage.tsx | 大 (807 行)    | ✅ 対応済み          | ✅ 対応済み              | `useWorldBuilding`フックと各タブを個別のコンポーネントに分離済み                                        |
| PlotPage.tsx          | 中 (457 行)    | ✅ 対応済み          | ✅ 対応済み              | `usePlot`フックと PlotItem 関連コンポーネントに分離済み                                                 |
| HomePage.tsx          | 中 (311 行)    | ✅ 対応済み          | ✅ 対応済み              | `useHome`フックと`ProjectCard`コンポーネントに分離済み                                                  |
| WritingPage.tsx       | 小 (100 行)    | ✅ 対応済み          | ✅ 対応済み              | `useWriting`フックと`ChapterList`, `WritingPreview`コンポーネントに分離済み                             |

## 機能ごとのコンポーネント対応状況

### characters 機能（`features/characters/`）

| コンポーネント    | ロジックと UI の分離 | コンポーネント構造 | 備考                                   |
| ----------------- | -------------------- | ------------------ | -------------------------------------- |
| CharacterCard.tsx | ✅ 対応済み          | ✅ 良好            | 単一責任の原則に従った設計             |
| CharacterList.tsx | ✅ 対応済み          | ✅ 良好            | 表示形式の切り替え機能を含む           |
| CharacterForm.tsx | ✅ 対応済み          | ✅ 良好            | ロジックを hooks に分離、UI のみを担当 |
| characterUtils.ts | ✅ 対応済み          | ✅ 良好            | ユーティリティ関数の分離               |

### plot 機能（`components/plot/`）

| コンポーネント         | ロジックと UI の分離 | コンポーネント構造 | 備考                             |
| ---------------------- | -------------------- | ------------------ | -------------------------------- |
| PlotItem.tsx           | ✅ 対応済み          | ✅ 良好            | 単一のプロットアイテム表示を担当 |
| PlotItemEditDialog.tsx | ✅ 対応済み          | ✅ 良好            | プロットアイテム編集ダイアログ   |

### worldbuilding 機能（`components/worldbuilding/`）

| コンポーネント              | ロジックと UI の分離 | コンポーネント構造 | 備考                           |
| --------------------------- | -------------------- | ------------------ | ------------------------------ |
| SocietyCultureTab.tsx       | ✅ 対応済み          | ✅ 良好            | 社会と文化タブを担当           |
| GeographyEnvironmentTab.tsx | ✅ 対応済み          | ✅ 良好            | 地理と環境タブを担当           |
| HistoryLegendTab.tsx        | ✅ 対応済み          | ✅ 良好            | 歴史と伝説タブを担当           |
| MagicTechnologyTab.tsx      | ✅ 対応済み          | ✅ 良好            | 魔法と技術タブを担当           |
| RulesTab.tsx                | ✅ 対応済み          | ✅ 良好            | ルールタブを担当               |
| PlacesTab.tsx               | ✅ 対応済み          | ✅ 良好            | 地名タブを担当                 |
| FreeFieldsTab.tsx           | ✅ 対応済み          | ✅ 良好            | 自由入力タブを担当             |
| TabPanel.tsx                | ✅ 対応済み          | ✅ 良好            | タブパネルの共通コンポーネント |
| WorldMapTab.tsx             | ✅ 対応済み          | ✅ 良好            | ワールドマップタブを担当       |
| SettingTab.tsx              | ✅ 対応済み          | ✅ 良好            | 世界観設定タブを担当           |

### home 機能（`components/home/`）

| コンポーネント  | ロジックと UI の分離 | コンポーネント構造 | 備考                           |
| --------------- | -------------------- | ------------------ | ------------------------------ |
| ProjectCard.tsx | ✅ 対応済み          | ✅ 良好            | プロジェクトカードの表示を担当 |

### writing 機能（`components/writing/`）

| コンポーネント     | ロジックと UI の分離 | コンポーネント構造 | 備考                       |
| ------------------ | -------------------- | ------------------ | -------------------------- |
| ChapterList.tsx    | ✅ 対応済み          | ✅ 良好            | 章のリスト表示を担当       |
| WritingPreview.tsx | ✅ 対応済み          | ✅ 良好            | 原稿のプレビュー表示を担当 |

### その他の機能ディレクトリ

- synopsis 機能 (`components/synopsis/`): ✅ 新規作成済み
- timeline 機能 (`components/timeline/`): ✅ 新規作成済み
- plot 機能 (`components/plot/`): ✅ 新規作成済み
- worldbuilding 機能 (`components/worldbuilding/`): ✅ 新規作成済み
- home 機能 (`components/home/`): ✅ 新規作成済み
- writing 機能 (`components/writing/`): ✅ 新規作成済み

## 改善方針

### ロジックと UI の分離

各ページコンポーネントに対して、以下の作業を行います：

1. ロジック部分をカスタムフックとして抽出する（例: `useCharacters`, `useTimeline`など）
2. 状態管理とイベントハンドラをフックに移動する
3. ページコンポーネントはフックから返された値を使用するのみにする

### コンポーネント構造の改善

各ページコンポーネントの UI を分割します：

1. 機能ごとに小さなコンポーネントに分割する
2. 共通パターンがある場合は汎用コンポーネントとして抽出する
3. ディレクトリ構造を feature-based なアプローチで整理する
   - `/features/{機能名}/` - 特定の機能に関連するコンポーネント
   - `/components/{機能名}/` - 特定の機能向けの UI コンポーネント
   - `/hooks/use{機能名}.ts` - 機能のロジックを含むカスタムフック

## 優先順位

1. ~~CharactersPage.tsx - 最も行数が多く複雑~~ ✅ 完了
2. ~~TimelinePage.tsx - 次に行数が多く複雑~~ ✅ 完了
3. ~~WorldBuildingPage.tsx - 3 番目に行数が多い~~ ✅ 完了
4. ~~PlotPage.tsx~~ ✅ 完了
5. ~~HomePage.tsx~~ ✅ 完了
6. ~~WritingPage.tsx~~ ✅ 完了

## リファクタリング手順

1. カスタムフックの作成（ロジックの分離）
2. UI コンポーネントの分割
3. 元のページコンポーネントの修正

## リファクタリング完了状況

全てのページコンポーネントのリファクタリングが完了しました。小説創作支援ツールのアーキテクチャ改善は成功したと言えます。

## その他改善検討事項

- グローバル状態管理の最適化
- エラーハンドリングパターンの統一
- 非同期処理の一貫したアプローチ
- テスト容易性の向上
- 共通 UI コンポーネントライブラリの整備
