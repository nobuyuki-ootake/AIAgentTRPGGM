# プロット画面機能定義

## 画面の目的と概要

プロット画面は、小説のストーリー構造を設計・管理するためのインターフェースです。ユーザーはこの画面でストーリーの流れ、プロットポイント、アークなどを整理し、物語の全体像を俯瞰的に把握することができます。

物語の核となるプロット設計を効率的に行うことで、執筆前の準備作業を支援し、一貫性のあるストーリー構築をサポートします。また、視覚的に物語構造を把握できることで、物語のバランスや展開の問題点を早期に発見することが可能になります。

## 主要な機能一覧

1. **プロット要素管理**

   - プロット要素（伏線、転換点、クライマックスなど）の作成・編集・削除
   - 要素のカテゴリ分け（序盤・中盤・終盤、伏線・転機・解決など）
   - 要素間の関連付け

2. **プロット構成の視覚化**

   - 三幕構成・八場構成などの構造テンプレートの提供
   - プロット要素を時系列または論理的順序で配置
   - プロット全体の流れの視覚的表現

3. **プロット分析**

   - ストーリーアークの分析
   - 物語の起伏やテンションの可視化
   - 主要キャラクターの役割とプロットへの関与度確認

4. **プロットテンプレート機能**

   - 一般的なストーリー構造テンプレートの適用
   - カスタムテンプレートの保存と再利用
   - 物語のジャンルに応じたテンプレート推奨

5. **サブプロット管理**
   - メインプロットに対するサブプロットの設定
   - サブプロットとメインプロットの関連性の表示
   - サブプロットの管理とメインプロットへの統合

## データ構造

主に以下のデータ構造を扱います：

```typescript
// プロット要素
interface PlotElement {
  id: string;
  title: string;
  description: string;
  category: "setup" | "confrontation" | "resolution";
  type: "foreshadowing" | "turning_point" | "climax" | "resolution";
  importance: number; // 1-5
  position: number; // 順序
  relatedCharacterIds: string[];
  relatedPlaceIds: string[];
  relatedElementIds: string[];
  notes: string;
}

// プロット構成
interface PlotStructure {
  id: string;
  name: string;
  description: string;
  elements: PlotElement[];
  template?: string;
  subplots: Subplot[];
}

// サブプロット
interface Subplot {
  id: string;
  name: string;
  description: string;
  elements: PlotElement[];
  relatedCharacterIds: string[];
}
```

## ユーザーフロー

1. **プロット作成・編集フロー**

   - プロット画面にアクセス
   - 新規プロット要素作成ボタンをクリック
   - 要素の詳細（タイトル、説明、種類、関連するキャラクターなど）を入力
   - 保存ボタンをクリックして要素を追加
   - ドラッグ＆ドロップで要素の順序を調整

2. **プロット構造テンプレート適用フロー**

   - テンプレート選択メニューを開く
   - 適用したいテンプレートを選択
   - テンプレートの構造に合わせてプロット要素を配置
   - 必要に応じてテンプレート構造を調整

3. **プロット分析フロー**

   - 分析ビューに切り替え
   - ストーリーアークのグラフを確認
   - 薄い部分やバランスが悪い部分を特定
   - 分析結果に基づいてプロット要素を修正

4. **サブプロット追加フロー**
   - サブプロットセクションで「新規サブプロット」をクリック
   - サブプロットの名前と説明を入力
   - 関連するキャラクターを選択
   - サブプロット要素を追加
   - メインプロットとの関連性を設定

## 関連コンポーネント

- **PlotList**: プロット要素一覧を表示するコンポーネント
- **PlotElementCard**: プロット要素の詳細を表示するカード
- **PlotTimeline**: プロット要素を時系列で表示するタイムライン
- **PlotStructureVisualizer**: プロット構造を視覚的に表示するコンポーネント
- **PlotAnalysisChart**: ストーリーアークの分析グラフを表示するコンポーネント
- **TemplateSelector**: プロットテンプレートを選択するコンポーネント
- **SubplotManager**: サブプロットを管理するコンポーネント

## 依存関係

- **usePlot** フック: プロット管理のロジックを提供
- **currentProjectState** (Recoil): 現在選択されているプロジェクト状態
- **charactersState** (Recoil): キャラクター情報へのアクセス
- **placesState** (Recoil): 場所情報へのアクセス
- **LocalStorage**: プロットデータの永続化
- **グラフ/チャート描画ライブラリ**: プロット分析の視覚化
