# タスク

## 2025-06-06完了

### TRPGセッション画面の空キャンペーン対応
- [x] UI/UXとロジックの分離完了
- [x] コンポーネント作成完了
- [x] Playwright MCPでChromium確認完了
- [x] TRPGセッション画面の動作確認完了
- [x] 空のキャンペーンデータ構造とデフォルト値定義
- [x] 完全に空のキャンペーン作成機能実装
- [x] 空データでのエラー回避とUI修正
- [x] JSONデータロード機能（デバッグ用）実装
- [x] ブラウザでの空キャンペーン表示確認
- [x] docs/chat.mdとtasks.mdの更新

## コンポーネント構成

### 1. SessionHeader
- キャンペーン名表示
- 現在地・日数・行動回数表示
- 保存ボタンとAIアシストボタン
- 開発者モード時のデバッグパネル切り替え

### 2. PartyPanel  
- パーティメンバー一覧表示
- キャラクター選択機能
- 選択中キャラクターの詳細表示
- 空の状態でも正常表示

### 3. MainContentPanel
- 探索・拠点・クエストタブ
- 現在地の表示と行動選択
- 拠点施設との相互作用
- 空の拠点データでも「利用可能な施設がありません」メッセージ

### 4. ChatAndDicePanel
- チャット機能とダイスロール機能
- セッションログの表示
- 各種判定ダイアログ

### 5. SessionDialogManager
- 全ダイアログの統合管理

### 6. DebugPanel
- 遭遇チェック、エネミー移動シミュレーション
- テストデータロード（JSONから）
- 空のキャンペーン作成機能
- デバッグログ出力

## 技術仕様

### 空のキャンペーンデータ構造
```typescript
// 完全に空のキャンペーン
characters: [],
npcs: [],
enemies: [],
bases: [],
worldBuilding: { places: [], cultures: [], bases: [], ... },
plot: [],
timeline: [],
sessions: []
```

### 主要機能
- **自動空キャンペーン作成**: TRPGセッション画面アクセス時に自動生成
- **デバッグデータロード**: 開発者モード時のJSONテストデータ読み込み
- **エラー耐性UI**: 空データでも美しく表示される堅牢なコンポーネント設計
- **明示的データ管理**: 仮データの自動投入を停止、ユーザー主導のデータ作成

### ファイル構成
- `useTRPGSessionUI.ts`: ビジネスロジックとUI状態管理
- `emptyCampaignDefaults.ts`: 空キャンペーンデータ生成
- `TRPGSessionPage.tsx`: メインページコンポーネント（153行）
- 各種子コンポーネント（SessionHeader、PartyPanel等）

## 完了成果
- **コード削減**: 3117行 → 153行 + 子コンポーネント群への分離
- **保守性向上**: 単一責任原則に基づくコンポーネント設計
- **エラー解決**: 無限ループエラーの完全解決
- **ユーザビリティ**: 空の状態からの直感的なキャンペーン作成
- **開発効率**: デバッグパネルによる開発・テスト効率化