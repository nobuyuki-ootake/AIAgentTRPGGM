# アーキテクチャ改善対象

本ドキュメントでは、アプリケーションのアーキテクチャを改善するために対応が必要なファイルと、その改善状況を記録します。

## 対応の種類

1. **ロジックと UI の分離**：ビジネスロジックをカスタムフックとして分離し、UI コンポーネントはプレゼンテーショナルな役割に集中させる
2. **コンポーネント構造の改善**：大きなコンポーネントを小さな再利用可能なコンポーネントに分割し、責任範囲を明確にする

## ページコンポーネントの対応状況

| ページコンポーネント  | ファイルサイズ | ロジックと UI の分離 | コンポーネント構造の改善 | 備考                                                                                                    |
| --------------------- | -------------- | -------------------- | ------------------------ | ------------------------------------------------------------------------------------------------------- |
| SynopsisPage.tsx      | 小 (66 行)     | ✅ 対応済み          | ✅ 対応済み              | `useSynopsis`フックと、`SynopsisEditor`, `SynopsisTips`, `UnsavedChangesDialog`コンポーネントに分離済み |
| CharactersPage.tsx    | 大 (1172 行)   | ✅ 対応済み          | ✅ 対応済み              | `useCharacters`フックと Character 関連コンポーネントに分離済み                                          |
| TimelinePage.tsx      | 大 (1091 行)   | ✅ 対応済み          | ✅ 対応済み              | `useTimeline`フックと Timeline 関連コンポーネントに分離済み                                             |
| WorldBuildingPage.tsx | 大 (807 行)    | ❌ 未対応            | ❌ 未対応                | 3 番目に大きなコンポーネントで優先度高                                                                  |
| PlotPage.tsx          | 中 (457 行)    | ❌ 未対応            | ❌ 未対応                | 中程度のサイズだが改善が必要                                                                            |
| HomePage.tsx          | 中 (311 行)    | ❌ 未対応            | ❌ 未対応                |                                                                                                         |
| WritingPage.tsx       | 小 (100 行)    | ❌ 未対応            | ❌ 未対応                | 比較的小さいが、一貫性のために対応が望ましい                                                            |

## 機能ごとのコンポーネント対応状況

### characters 機能（`features/characters/`）

| コンポーネント    | ロジックと UI の分離 | コンポーネント構造 | 備考                                   |
| ----------------- | -------------------- | ------------------ | -------------------------------------- |
| CharacterCard.tsx | ✅ 対応済み          | ✅ 良好            | 単一責任の原則に従った設計             |
| CharacterList.tsx | ✅ 対応済み          | ✅ 良好            | 表示形式の切り替え機能を含む           |
| CharacterForm.tsx | ✅ 対応済み          | ✅ 良好            | ロジックを hooks に分離、UI のみを担当 |
| characterUtils.ts | ✅ 対応済み          | ✅ 良好            | ユーティリティ関数の分離               |

### その他の機能ディレクトリ

- synopsis 機能 (`components/synopsis/`): ✅ 新規作成済み
- timeline 機能 (`components/timeline/`): ✅ 新規作成済み
- plot 機能: ❌ 未作成
- worldbuilding 機能: ❌ 未作成
- writing 機能: ❌ 未作成

## 改善方針

### ロジックと UI の分離

各ページコンポーネントに対して、以下の作業を行います：

1. ロジック部分をカスタムフックとして抽出する（例: `useCharacters`, `useTimeline`など）
2. 状態管理とイベントハンドラをフックに移動する
3. ページコンポーネントはフックから返された値を使用するのみにする

### コンポーネント構造の改善

各ページコンポーネントの UI を分割します：

1. 機能ごとに小さなコンポーネントに分割する
2. 共通パターンがある場合は汎用コンポーネントとして抽出する
3. ディレクトリ構造を feature-based なアプローチで整理する
   - `/features/{機能名}/` - 特定の機能に関連するコンポーネント
   - `/components/{機能名}/` - 特定の機能向けの UI コンポーネント
   - `/hooks/use{機能名}.ts` - 機能のロジックを含むカスタムフック

## 優先順位

1. ~~CharactersPage.tsx - 最も行数が多く複雑~~ ✅ 完了
2. ~~TimelinePage.tsx - 次に行数が多く複雑~~ ✅ 完了
3. WorldBuildingPage.tsx - 3 番目に行数が多い
4. PlotPage.tsx
5. HomePage.tsx
6. WritingPage.tsx

## リファクタリング手順

1. カスタムフックの作成（ロジックの分離）
2. UI コンポーネントの分割
3. 元のページコンポーネントの修正

## その他改善検討事項

- グローバル状態管理の最適化
- エラーハンドリングパターンの統一
- 非同期処理の一貫したアプローチ
- テスト容易性の向上
- 共通 UI コンポーネントライブラリの整備
