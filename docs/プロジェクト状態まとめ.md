# NovelWithAgent プロジェクト状態まとめ

## 1. プロジェクト概要

AI支援による小説作成ツール。日本の小説執筆に特化した統合開発環境を提供。

## 2. 技術スタック

### フロントエンド
- **言語**: TypeScript
- **フレームワーク**: React 18.2.0
- **UIライブラリ**: Material UI (MUI) v7
- **状態管理**: Recoil 0.7.7
- **ルーティング**: React Router v7
- **エディタ**: Slate.js 0.112.0
- **ビルドツール**: Vite 6.3.1
- **テスト**: Playwright, Vitest

### バックエンド
- **言語**: TypeScript
- **フレームワーク**: Express.js 4.18.2
- **AIフレームワーク**: Mastra 0.6.1
- **AI SDK**: 
  - OpenAI SDK 4.28.0
  - Anthropic SDK 0.11.0
  - Google Generative AI 0.3.0
- **キャッシュ**: Redis (ioredis 5.3.2)
- **ロギング**: Winston 3.11.0

### インフラ・デプロイ
- **パッケージ管理**: pnpm (モノレポ構成)
- **ビルド最適化**: Turbo
- **コンテナ**: Docker Compose
- **デプロイ先**:
  - Railway (主要デプロイ先、Nixpacksビルダー使用)
  - AWS App Runner (代替デプロイオプション)
  - Vercel (フロントエンドのみ対応可能)

## 3. 各画面の概要

### 1. ホーム画面
- プロジェクトの作成・選択・削除
- プロジェクトカード表示（タイトル、最終更新日、あらすじ）
- 機能説明セクション

### 2. あらすじ画面
- 物語の全体構想を記述
- 自由形式のテキストエディタ
- AI生成支援機能
- 自動保存機能

### 3. キャラクター画面
- キャラクターカードのグリッド表示
- 詳細プロフィール（基本情報、背景、動機、関係性）
- 役割カテゴリ（主人公、敵対者、脇役など）
- カスタムフィールドとステータス管理

### 4. プロット画面
- 物語構造の設計
- 伏線、転換点、クライマックスの管理
- 三幕構成テンプレート
- サブプロット管理
- ストーリーアーク分析

### 5. タイムライン画面
- 二次元タイムライン（時間×場所）
- イベントのドラッグ&ドロップ配置
- キャラクター・場所・タイプ別フィルタリング
- イベント間の関係性定義
- 重要度レベル（1-5）設定

### 6. 世界観構築画面
- 10個のタブによる体系的な世界設定：
  - 世界地図
  - 基本設定
  - ルール・法則
  - 場所
  - 社会・文化
  - 地理・環境
  - 歴史・伝説
  - 魔法・技術
  - 状態定義
  - 自由記述欄

### 7. 執筆画面（3ペイン構成）
- **左ペイン**: 章リストと関連イベント表示
- **中央ペイン**: 縦書き原稿エディタ（400字詰め原稿用紙形式）
- **右ペイン**: AIアシストコントロールとイベント管理
- 機能：章管理、ページ区切り、AI章生成、自動保存

## 4. AIチャットパネルの機能

### 基本構成
- 画面右下の折りたたみ可能なフローティングパネル
- 3つのタブ構成：

### 1. チャットタブ
- AIとの自由な対話
- メッセージ履歴の保持
- コンテキスト認識（選択要素の参照）

### 2. アシストタブ
- 画面固有のAI支援機能
- 一括生成ボタン
- プログレス表示

### 3. 設定タブ
- AIプロバイダー選択（OpenAI、Claude、Gemini、カスタム）
- APIキー管理
- モデル選択
- パラメータ設定（temperature、max_tokens）

## 5. 現在有効なAPI

### AI関連エンドポイント（/api/ai-agent/）
- `POST /chat` - 汎用AIチャット
- `POST /plot-advice` - プロット開発アドバイス
- `POST /plot-development` - プロット全体生成
- `POST /synopsis-generation` - あらすじ生成
- `POST /synopsis-advice` - あらすじ改善提案
- `POST /character-advice` - キャラクター開発支援
- `POST /character-generation` - 単体キャラクター生成
- `POST /character-list-generation` - キャラクターリスト一括生成
- `POST /character-detail-generation` - キャラクター詳細生成
- `POST /worldbuilding-advice` - 世界観構築アドバイス
- `POST /worldbuilding-list-generation` - 世界観要素一括生成
- `POST /worldbuilding-detail-generation` - 世界観要素詳細生成
- `POST /chapter-generation` - 章内容生成
- `POST /timeline-event-generation` - タイムラインイベント生成
- `POST /style-advice` - 文体改善提案
- `GET /settings` - API設定取得
- `POST /settings` - API設定更新
- `POST /test-key` - APIキー検証

### プロバイダー別エンドポイント
- `/api/openai/*` - OpenAI直接アクセス
- `/api/claude/*` - Claude直接アクセス
- `/api/gemini/*` - Gemini直接アクセス

## 6. 小説作成のための設定可能項目

### プロジェクトレベル
- タイトル、著者名、ジャンル
- あらすじ
- プロジェクトメタデータ（タグ、ステータス、目標文字数）

### キャラクター設定
- 基本情報（名前、役割、性別、年齢）
- 背景と動機
- カスタム特性とフィールド
- ステータス（生存、異常、カスタム）
- 関係性（タイプと説明）

### 世界観設定
- 10カテゴリにわたる詳細設定
- 場所の管理と説明
- 文化・社会構造の定義
- ルールと法則
- カスタムフィールド

### タイムライン設定
- 開始・終了日
- 表示モード（日/週/月/年）
- イベント重要度
- カスタムイベントタイプ

### 執筆設定
- 章の順序と構造
- AI生成パラメータ（長さ、スタイル）
- エディタ表示モード

## 7. 執筆用機能の3ペイン詳細

### 左ペイン - 章管理
- 章リストの表示と並び替え
- 新規章作成ボタン
- 章タイトルの編集
- 関連イベントの表示
- 章の削除機能

### 中央ペイン - 縦書きエディタ
- 400字詰め原稿用紙スタイル
- 日本語縦書き表示
- リッチテキスト編集（Slate.js使用）
- ページ区切り機能
- 自動保存（デバウンス付き）

### 右サイド - AI・イベント管理
- AIアシストボタン
- 章生成オプション（文字数、スタイル指定）
- タイムラインイベントの関連付け
- イベント詳細表示
- 生成時のコンテキスト選択

## 8. 特徴的な機能

### ウォーターフォール型作成フロー
- 各画面が前の画面のデータを参照
- 蓄積されたコンテキストをAIが活用
- 段階的な作品構築をサポート

### 日本語小説特化
- 縦書き原稿用紙フォーマット
- 日本語に最適化されたAIプロンプト
- 文体・表現の日本語対応

### 包括的なAI統合
- すべての作成段階でAI支援
- 複数AIプロバイダーのサポート
- コンテキスト認識型の生成

### オフライン対応
- LocalStorageによるデータ保存
- エクスポート/インポート機能
- バックエンド非依存のデータ管理