# 画面遷移図

## 概要

TRPG AI エージェント GM システムの画面遷移を図解し、ユーザビリティ設計と E2E テスト設計のための参考資料として提供します。

## 全体画面遷移図

```mermaid
graph TD
    A[ホーム画面] --> B[キャンペーン一覧]
    A --> C[新規キャンペーン作成]
    
    C --> D[キャンペーン作成ウィザード]
    D --> E[キャンペーン詳細画面]
    B --> E
    
    E --> F{開発者モード判定}
    
    F -->|一般モード| G[TRPG セッション画面]
    F -->|開発者モード| H[キャンペーン管理画面]
    
    G --> I[セッション結果画面]
    I --> A
    
    H --> J[キャラクター管理画面]
    H --> K[タイムライン管理画面]
    H --> L[世界観構築画面]
    H --> M[プロット管理画面]
    H --> N[あらすじ管理画面]
    H --> O[執筆画面]
    
    J --> P[キャラクター詳細・編集画面]
    K --> Q[イベント詳細・編集画面]
    L --> R[拠点・文化詳細画面]
    
    P --> J
    Q --> K
    R --> L
    
    style A fill:#e1f5fe
    style G fill:#fff3e0
    style H fill:#fff9c4
    style I fill:#c8e6c9
```

## モード別画面構成

### 一般ユーザーモード画面遷移

```mermaid
flowchart TD
    A[ホーム画面] --> B[キャンペーン選択]
    B --> C[キャラクター選択]
    C --> D[セッションモード選択]
    
    D --> E{プレイモード}
    E -->|シングルプレイ| F[ソロセッション画面]
    E -->|マルチプレイ| G[マルチセッション画面]
    
    F --> H[セッション進行画面]
    G --> H
    
    H --> I{セッション状態}
    I -->|進行中| J[イベント処理画面]
    I -->|一時停止| K[保存・設定画面]
    I -->|完了| L[結果・報酬画面]
    
    J --> M{イベント種類}
    M -->|戦闘| N[戦闘画面]
    M -->|会話| O[NPC 対話画面]
    M -->|探索| P[調査・判定画面]
    M -->|トラップ| Q[トラップ判定画面]
    
    N --> R[ダイスロール画面]
    O --> S[選択肢画面]
    P --> R
    Q --> R
    
    R --> T[結果表示画面]
    S --> T
    T --> H
    
    K --> U{設定項目}
    U -->|保存| V[進行状況保存]
    U -->|設定| W[ゲーム設定画面]
    U -->|履歴| X[セッション履歴画面]
    
    V --> H
    W --> H
    X --> H
    
    L --> Y[キャンペーン完了画面]
    Y --> A
    
    style A fill:#e1f5fe
    style H fill:#fff3e0
    style N fill:#ffcdd2
    style O fill:#f3e5f5
    style Y fill:#c8e6c9
```

## テスト観点での重要な遷移

### クリティカルパス
1. **ホーム → キャンペーン選択 → セッション開始 → イベント処理 → セッション完了**
2. **開発者モード → キャラクター作成 → 保存 → セッションで利用**
3. **タイムライン作成 → イベント設定 → セッションでの自動発火**

### エラー復旧パス
1. **エラー発生 → エラー画面 → 再試行 → 正常復帰**
2. **ネットワーク断 → オフラインモード → 再接続 → 同期**
3. **AI エラー → 代替処理 → 手動進行 → AI 復旧**

### 状態管理確認
1. **画面遷移時のデータ保持**
2. **ブラウザリロード時の状態復元**
3. **マルチタブでの状態同期**

この画面遷移図は E2E テストでの画面ナビゲーション設計と、UI/UX の一貫性確保に活用されます。