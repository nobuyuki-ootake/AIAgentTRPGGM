# クリア条件機能実装テストガイド

## 実装された機能

### 1. 型定義の拡張
- `EventCondition`: イベント発生条件の型定義
- `ClearCondition`: キャンペーンクリア条件の型定義
- `TRPGCampaign.clearConditions`: キャンペーンにクリア条件フィールドを追加

### 2. 最終日の特別UI
- タイムライン画面で最終日（dateArray の最後の日）にのみ「クリア条件設定」ボタンが表示される
- ボタンは旗アイコン付きで視覚的に識別しやすい

### 3. クリア条件設定ダイアログ
- 包括的なクリア条件設定画面
- 対応する条件タイプ：
  - アイテム収集（キーアイテムの所持）
  - クエスト完了
  - キャラクター生存
  - 場所到達
  - ストーリー節目
  - カスタム条件

## テスト手順

### 前提条件
1. キャンペーンが作成済み
2. アイテムが登録済み（キーアイテムタイプ）
3. タイムラインで複数日程が設定済み

### テスト1: 最終日ボタンの表示確認
1. タイムライン画面を開く
2. 開発者モードを有効にする
3. 最終日のカードに「クリア条件設定」ボタンが表示されることを確認
4. 最終日以外のカードにはボタンが表示されないことを確認

### テスト2: クリア条件ダイアログの動作確認
1. 最終日の「クリア条件設定」ボタンをクリック
2. ダイアログが開くことを確認
3. 「条件を追加」ボタンをクリック
4. 各フィールドが正しく入力できることを確認：
   - 条件名
   - 条件の説明
   - 条件タイプ（ドロップダウン）
   - 重要度（ドロップダウン）

### テスト3: アイテム収集条件の設定
1. 条件タイプで「アイテム収集」を選択
2. 「アイテム追加」ボタンをクリック
3. キーアイテムが選択できることを確認
4. 数量が設定できることを確認
5. 「条件を追加」ボタンをクリック
6. 設定済み条件リストに表示されることを確認

### テスト4: 条件の保存と表示
1. 複数の条件を追加
2. 「クリア条件を保存」をクリック
3. ダイアログを閉じて再度開く
4. 保存した条件が正しく表示されることを確認

### テスト5: 条件の削除
1. 設定済みの条件を展開
2. 削除ボタン（ゴミ箱アイコン）をクリック
3. 条件が削除されることを確認

## 期待される動作

### 成功パターン
- 最終日にのみクリア条件設定ボタンが表示される
- ダイアログが正常に開閉する
- 各条件タイプに応じた設定フィールドが表示される
- 設定した条件が保存・表示される
- 条件の削除が正常に動作する

### エラーハンドリング
- 必須フィールドが空の場合、追加ボタンが無効化される
- 無効なデータでの保存が防止される
- ユーザーフレンドリーなエラーメッセージが表示される

## 実装ファイル

### 新規作成
- `apps/frontend/src/components/timeline/ClearConditionDialog.tsx`

### 更新されたファイル
- `packages/types/index.ts` - 型定義追加
- `apps/frontend/src/components/timeline/TimelineDayList.tsx` - 最終日UI追加
- `apps/frontend/src/pages/TimelinePage.tsx` - ダイアログ統合

## 次のステップ

キーアイテム所持を前提とするイベント作成機能の実装:
1. `TimelineEventDialog`でイベント条件設定UI追加
2. イベント保存時に条件データを含める
3. イベント表示時に条件情報を表示
4. 条件チェック機能の実装